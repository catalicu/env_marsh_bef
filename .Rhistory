seqtab.table= readRDS('input_data/ASVtable_Marsh12021-07-20.rds')
list.files()
setwd("~/Library/CloudStorage/GoogleDrive-cc349@humboldt.edu/My Drive/CGLab_shared drive/CGLab_Graduate Student Resources/Individual Student folders - Back up/Grandmont-Lemire (Thompson)/Scripts")
list.files()
seqtab.table= readRDS('input_data/ASVtable_Marsh12021-07-20.rds')
seqtab.table= readRDS('/input_data/ASVtable_Marsh12021-07-20.rds')
list.files('input_data')
seqtab.table= read.table('/input_data/ASVtable_Marsh12021-07-20.txt')
seqtab.table= read.table('/input_data/ASVtable_Marsh12021-07-20.txt')
seqtab.table= read.table('input_data/ASVtable_Marsh12021-07-20.txt')
seqtab.table= read.table('input_data/ASVtable_Marsh12021-07-20.txt')
#load the mappingfile
mapping_file=read.table('input_data/METAtable_Marsh12021-07-20.txt', header=TRUE)
mapping_file
#load the metadata
meta.table=read.table('input_data/TableDeltaNH3_Div.summary.211.txt', header=TRUE)
meta.table=read.table('input_data/TableDeltaNH3_Div.summary.211.txt', header=TRUE)
list.files()
list.files('input_data')
#load the metadata
meta.table=read.csv('input_data/TableDeltaNH3_Div.summary.211.csv', header=TRUE)
#load the metadata
meta.table=read.csv('input_data/TableDeltaNH3_Div.summary.211.csv', header=TRUE)
head(meta.table)
head(seqtab.table)
rownames(seqtab.table)
colnames(seqtab.table)
View(mapping_file)
meta.table
ASVtable=read.table('input_data/ASVtable_Marsh12021-07-20.txt', header=TRUE)
TAXtable=read.table('input_data/TAXtable_Marsh12021-07-20.txt', header=TRUE)
TAXtable=read.table('input_data/TAXtable_Marsh12021-07-20.txt', header=TRUE)
meta.table=read.table('input_data/METAtable_Marsh12021-07-20.txt', header=TRUE)
View(meta.table)
setwd("~/Library/CloudStorage/GoogleDrive-cc349@humboldt.edu/My Drive/CGLab_shared drive/CGLab_Graduate Student Resources/Individual Student folders - Back up/Grandmont-Lemire (Thompson)/Scripts")
outPATH='output_files/'
date=Sys.Date()
# Libraries
library(ggplot2)
#library(vegan)
#library(dplyr)
#library(lme4)
#library(nlme)
library(gridExtra)
#library(reshape2)
#library(car)
#library(MASS)
# Plot themes
## With legend
Theme=theme_classic(base_size=11, base_family="Helvetica") +
theme(axis.line = element_line(size = 1, colour = "black", linetype = "solid")) +theme(plot.title = element_text(size = 12))
## Without legends
Theme2=Theme+ theme(legend.position="none") + theme(panel.border=element_rect(fill=NA))
ASVtable=read.table('input_data/ASVtable_Marsh12021-07-20.txt', header=TRUE)
TAXtable=read.table('input_data/TAXtable_Marsh12021-07-20.txt', header=TRUE)
meta.table=read.table('input_data/METAtable_Marsh12021-07-20.txt', header=TRUE)
View(meta.table)
# create list of ASV:
ASVfun_names=names(ASVtable.fundiv1)
ASVtable.fundiv=read.table('output_files/ASVtable_forGLM_FunExp12023-01-04.txt', header=TRUE)
setwd(dirname(getwd()))
PATH="/Users/cc349/Library/CloudStorage/GoogleDrive-cc349@humboldt.edu/My Drive/CGLab_shared drive/CGLab_Graduate Student Resources/Individual Student folders - Back up/Grandmont-Lemire (Thompson)"
knitr::opts_knit$set(root.dir=PATH)
library(ggplot2)
library(vegan)
library(phyloseq)
library(dplyr)
library(plyr)
library(lme4)
library(nlme)
library(gridExtra)
library(car)
Theme=theme_classic(base_size=11, base_family="Helvetica") +
theme(axis.line = element_line(linewidth = 1, colour = "black", linetype = "solid")) +theme(plot.title = element_text(size = 12))+ theme(panel.border=element_rect(fill=NA))
Theme2=Theme+ theme(legend.position="none") + theme(panel.border=element_rect(fill=NA))
Theme3=Theme+ theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.2))
Theme4=Theme2 + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.2))
meta.env=read.csv('input_data/Metadata/Div.summary.211.csv', header=TRUE)
meta.div=read.table('Outputs/MetaDiv2_table_marsh20242024-10-09.txt', header=TRUE)
# season
meta.env$Season=factor(meta.env$Season,
levels=c('Autumn', 'Winter', 'Spring'))
# location
meta.env$Location=factor(meta.env$Location,
levels=c('OxPond_1', 'OxPond2', 'Treatmentmarshes','EW_influent', 'Allen', 'Gearheart','Hauser', 'BayDischarge'))
meta.env$Date_form=as.Date(meta.env$Date_form)
meta.env2=meta.env[,-c(1,4,14)]
head(meta.env2)
Ammonia.plot=ggplot(aes(Location, Ammonia), data=meta.env2) +
geom_boxplot() +
geom_jitter(alpha=0.5, size=3,aes(shape=Location, color=Season)) +
Theme2 +theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5)) +
scale_shape_manual(values=c(16,17,18,3,4,7,8,10)) +
scale_color_manual(values=c('orange', 'black', 'yellow')) +
ylab('Ammonia (mg/L)')
plot(Ammonia.plot)
# normality
qqnorm((meta.env2$Ammonia))
hist(meta.env2$Ammonia)
shapiro.test((meta.env2$Ammonia))
# season effect on delta ammonia
summary(glm(Ammonia~Season, data=meta.env2, family=gaussian))
Anova(glm(Ammoniae~Season, data=meta.env2, family=gaussian))
Anova(glm(Ammonia~Season, data=meta.env2, family=gaussian))
# delta ammonia and location
summary(lm(dAmmonia~Location, data=meta.env2))
# delta ammonia and location
summary(lm(Ammonia~Location, data=meta.env2))
# delta ammonia season and location
summary(lm(Ammonia~Season*Location, data=meta.env2))
Anova(lm(Ammonia~Season*Location, data=meta.env2))
# as glmm
ammonia_glmm=lmer(Ammonia~Season + (1|Location), data=meta.env2)
# compare mixed model to lm model without location
# first create a mock random variable
meta.env2$Loc_mock=(rep(1,length(meta.env2$Location)))
# create a glmm where the random component has no variation
# notice the control modification so it allows for no groups in random variable
mod.env.null.lmei0=lmer(Ammonia~ 1 + (1|Loc_mock), data=meta.env2, control=lmerControl(check.nlev.gtr.1 = "ignore"))
# this one is a glmm but only with season as fixed factor (no location as random, mock random instead)
mod.env.season.lmei0=lmer(Ammonia~ Season + (1|Loc_mock), data=meta.env2, control=lmerControl(check.nlev.gtr.1 = "ignore"))
AIC(mod.env.null.lmei0, mod.env.season.lmei0, ammonia_glmm,lm(Ammonia~1, data=meta.env2),
lm(Ammonia~Season, data=meta.env2))
mod.env.null=lm(Ammonia ~ 1, data=meta.env2)
# this one only has location (as random)
mod.env.lmei0=lmer(Ammonia~ 1 + (1|Location), data=meta.env2, control=lmerControl(check.nlev.gtr.1 = "ignore"))
# this one is a glmm but only with season as fixed factor (no location as random, mock random instead)
mod.env.season.lmei0=lmer(Ammonia~ Season + (1|Loc_mock), data=meta.env2, control=lmerControl(check.nlev.gtr.1 = "ignore"))
mod.env.null=lm(Ammonia ~ 1, data=meta.env2)
# compare mixed model to lm model without location
# first create a mock random variable
meta.env2$Loc_mock=(rep(1,length(meta.env2$Location)))
# create a glmm where the random component has no variation
# notice the control modification so it allows for no groups in random variable
mod.env.null.lmei0=lmer(Ammonia~ 1 + (1|Loc_mock), data=meta.env2, control=lmerControl(check.nlev.gtr.1 = "ignore"))
# this one only has location (as random)
mod.env.lmei0=lmer(Ammonia~ 1 + (1|Location), data=meta.env2, control=lmerControl(check.nlev.gtr.1 = "ignore"))
# this one is a glmm but only with season as fixed factor (no location as random, mock random instead)
mod.env.season.lmei0=lmer(Ammonia~ Season + (1|Loc_mock), data=meta.env2, control=lmerControl(check.nlev.gtr.1 = "ignore"))
# this one is the full model
mod.env.season.lmei=lmer(Ammonia~ Season + (1|Location), data=meta.env2, control=lmerControl(check.nlev.gtr.1 = "ignore"))
AIC(mod.env.null, mod.env.null.lmei0, mod.env.lmei, mod.env.season.lmei0, mod.env.season.lmei,
lm(Ammonia~Season, data=meta.env2))
# this one only has location (as random)
mod.env.lmei=lmer(Ammonia~ 1 + (1|Location), data=meta.env2, control=lmerControl(check.nlev.gtr.1 = "ignore"))
AIC(mod.env.null, mod.env.null.lmei0, mod.env.lmei, mod.env.season.lmei0, mod.env.season.lmei,
lm(Ammonia~Season, data=meta.env2))
Theme=theme_classic(base_size=11, base_family="Helvetica") +
theme(axis.line = element_line(linewidth = 1, colour = "black", linetype = "solid")) +theme(plot.title = element_text(size = 12))
library(vegan)
# Libraries
library(ggplot2)
# load species tables
ASVtable=read.table('phyloseq_outputs/ASVtable_Marsh12021-07-20.txt', header=TRUE)
setwd("~/Documents/GitHub/SGL/env_marsh_bef/scripts")
# load species tables
ASVtable=read.table('phyloseq_outputs/ASVtable_Marsh12021-07-20.txt', header=TRUE)
# load species tables
ASVtable=read.table('phyloseq_outputs/ASVtable_Marsh12021-07-20.txt', header=TRUE)
getwd
getwd()
setwd("~/Documents/GitHub/SGL/env_marsh_bef")
# load species tables
ASVtable=read.table('phyloseq_outputs/ASVtable_Marsh12021-07-20.txt', header=TRUE)
ASVtable2=t(ASVtable)
ASVtable3=ASVtable2[-c(1:23),]
TAXtable=read.table('phyloseq_outputs/TAXtable_Marsh12021-07-20.txt', header=TRUE)
metatable=read.table('phyloseq_outputs/METAtable_Marsh12021-07-20.txt', header=TRUE)
metatable2=metatable[-c(1:23),]
normalizePath(sys.frame(1)$ofile)
sys.frame()
sys.frame(1)
sys.frame(date)
?sys.frame
setwd('..')
getwd()
list.files()
setwd("~/Documents/GitHub/SGL/env_marsh_bef")
dirname
dirname()
dirname(getwd())
TAXtable=read.table('phyloseq_outputs/TAXtable_Marsh12021-07-20.txt', header=TRUE)
metatable=read.table('phyloseq_outputs/METAtable_Marsh12021-07-20.txt', header=TRUE)
metatable2=metatable[-c(1:23),]
metatable2$sampleID=metatable2$X.SampleID
# metadata tables
meta.table=read.csv('inputs_data/Metadata_marshstudy.csv', header=TRUE)
meta.table$sampleID=meta.table$SampleID
env.table=read.csv('inputs_data/Envdata_marshstudy.csv', header=TRUE)
env.table2=env.table[-which(duplicated(env.table$sampleID)),]
metatable2$sampleID=metatable2$X.SampleID
# metadata tables
meta.table=read.csv('inputs_data/Metadata_marshstudy.csv', header=TRUE)
getwd()
# metadata tables
meta.table=read.csv('input_data/Metadata_marshstudy.csv', header=TRUE)
meta.table$sampleID=meta.table$SampleID
env.table=read.csv('inputs_data/Envdata_marshstudy.csv', header=TRUE)
env.table=read.csv('input_data/Envdata_marshstudy.csv', header=TRUE)
env.table=read.csv('input_data/Envdata_marshstudy.csv', header=TRUE)
env.table2=env.table[-which(duplicated(env.table$sampleID)),]
# merge env, meta:
env.table3=env.table2[which(env.table2$sampleID  %in%  metatable2$sampleID),]
meta1=left_join(metatable2, env.table3, by=c('sampleID'))
meta2=left_join(metatable, meta1)
richness=specnumber(ASVtable3, MARGIN=1)
shannon=diversity(ASVtable3, index='shannon', MARGIN=1)
simpson=diversity(ASVtable3, index='simpson', MARGIN=1)
evenness=shannon/log(richness)
meta.div=data.frame(meta1, richness, shannon, simpson, evenness)
meta.div=data.frame(meta1, richness, shannon, simpson, evenness)
meta.div=data.frame(meta2, richness, shannon, simpson, evenness)
meta1=left_join(metatable2, env.table3, by=c('sampleID'))
#library(plyr)
library(dplyr)
meta1=left_join(metatable2, env.table3, by=c('sampleID'))
meta2=left_join(metatable, meta1)
meta.div=data.frame(meta2, richness, shannon, simpson, evenness)
meta.div=data.frame(meta2, richness, shannon, simpson, evenness)
richness
head(meta2)
meta2[,1]
richness
rownames(ASVtable3)
rownames(ASVtable3)%in%meta2[,1]
rownames(ASVtable3)%in%meta2[,1]%in%rownames(ASVtable3)
rownames(ASVtable3)%in%meta2[,1]
meta2[,1]%in%rownames(ASVtable3)
#merge metadata and univariate diversity measures
meta2[which(meta2[,1]%in%rownames(ASVtable3)),]
#merge metadata and univariate diversity measures
meta3=meta2[which(meta2[,1]%in%rownames(ASVtable3)),]
meta.div=data.frame(meta3, richness, shannon, simpson, evenness)
# summary
Div.summary=ddply(meta.div, .(Sample_Location, Date_sampled), summarize, count=length(richness), meanR=mean(richness), sdR=sd(richness), meanShann=mean(shannon), sdShan=sd(shannon), meanSimp=mean(simpson), sdSimp=sd(simpson), meanE=mean(evenness), sdE=sd(evenness))
Div.summary
Div.summary
# summary
Div.summary=ddply(meta.div, .(Sample_Location, Date_sampled), summarize, count=length(richness), meanR=mean(richness), sdR=sd(richness), meanShann=mean(shannon), sdShan=sd(shannon), meanSimp=mean(simpson), sdSimp=sd(simpson), meanE=mean(evenness), sdE=sd(evenness))
library(plyr)
# summary
Div.summary=ddply(meta.div, .(Sample_Location, Date_sampled), summarize, count=length(richness), meanR=mean(richness), sdR=sd(richness), meanShann=mean(shannon), sdShan=sd(shannon), meanSimp=mean(simpson), sdSimp=sd(simpson), meanE=mean(evenness), sdE=sd(evenness))
Div.summary
#ggplot(Div.summary, aes(Sample_Location, meanR)) + geom_point(size=3, color='black', shape=21, aes(fill=Date_sampled))+ geom_errorbar(aes(x=Sample_Location, ymin=meanR-sdR, ymax=meanR+sdR))+ Theme
ggplot(Div.summary, aes(Sample_Location, meanR)) + geom_point(size=3, color='black', shape=21, aes(fill=Date_sampled))+ Theme
meta.env$Date_form=as.Date(meta.env$Date_form)
# Plot themes
## With legend
Theme=theme_classic(base_size=11, base_family="Helvetica") +
theme(axis.line = element_line(linewidth = 1, colour = "black", linetype = "solid")) +theme(plot.title = element_text(size = 12))
## Without legends
Theme2=Theme+ theme(legend.position="none") + theme(panel.border=element_rect(fill=NA))
# location
meta.env$Location=factor(meta.env$Location,
levels=c('OxPond_1', 'OxPond2', 'Treatmentmarshes',
'EW_influent', 'Allen', 'Gearheart','Hauser',
'BayDischarge'))
meta3$Season
head(meta3)
env.summary.table=read.csv('input_data/TableDeltaNH3_Div.summary.211.csv', header=TRUE)
dim(env.summary.table)
dim(env.table)
dim(env.table[-which(env.table$type=='sludge')])
head(env.table)
env.table$type=='sludge'
which(env.table$type=='sludge')
dim(env.table[-which(env.table$type=='sludge'),])
dim(env.summary.table)
table(env.summary.table)
table()
?table
table(env.summary.table$Date_sampled)
table(env.table$Date)
## summary environmental:
### removed sludge data
env.wSlu=env.table[-which(env.table$type=='sludge'),]
table(env.wSlu$Date)
env.wSlu[which(env.wSlu$Date=='1/10/2019'),]
(env.wSlu$Date=='1/10/2019')
(env.wSlu$Date)
env.wSlu[which(env.wSlu$Date=='1/10/2020'),]
env.summary.table[which(env.summary.table$Date_sampled=='1/10/2020'),]
head(meta.tabel)
head(meta.table)
head(metatable)
head(ASVtable)
head(ASVtable[1:3,1:3])
View(ASVtable)
dim(ASVtable)
dim(metatable)
dim(TAXtable)
colnames(TAXtable)
dim(meta.table)
dim(metatable)
rownames(meta.table)
metatable[,1]
meta.table[,1]
head(metatable)
head(env.table)
dim(env.table)
dim(env.wSlu)
dim(env.summary.table)
View(env.wSlu)
View(env.summary.table)
colnames(env.wSlu)
data.frame(colnames(env.wSlu), data.frame(env.summary.table))
colnames(env.summary.table)
env.summary1=env.summary.table[,-1]
colnames(env.wSlu)
colnames(env.summary1)
setwd(dirname(getwd()))
PATH="/Users/cc349/Library/CloudStorage/GoogleDrive-cc349@humboldt.edu/My Drive/CGLab_shared drive/CGLab_Graduate Student Resources/Individual Student folders - Back up/Grandmont-Lemire (Thompson)"
knitr::opts_knit$set(root.dir=PATH)
library(ggplot2)
library(vegan)
library(phyloseq)
library(dplyr)
library(plyr)
library(lme4)
library(nlme)
library(gridExtra)
library(car)
Theme=theme_classic(base_size=11, base_family="Helvetica") +
theme(axis.line = element_line(linewidth = 1, colour = "black", linetype = "solid")) +theme(plot.title = element_text(size = 12))+ theme(panel.border=element_rect(fill=NA))
Theme2=Theme+ theme(legend.position="none") + theme(panel.border=element_rect(fill=NA))
ASVtable=read.table('input_data/from_phyloseq/ASVtable_marsh12024-10-08.txt', header=TRUE)
setwd("~/Library/CloudStorage/GoogleDrive-cc349@humboldt.edu/My Drive/CGLab_shared_drive/CGLab_Graduate Students/Individual Student Folders - Keep It Updated/Grandmont-Lemire (Thompson)/Scripts")
setwd(dirname(getwd()))
PATH="/Users/cc349/Library/CloudStorage/GoogleDrive-cc349@humboldt.edu/My Drive/CGLab_shared drive/CGLab_Graduate Student Resources/Individual Student folders - Back up/Grandmont-Lemire (Thompson)"
knitr::opts_knit$set(root.dir=PATH)
library(ggplot2)
library(vegan)
library(phyloseq)
library(dplyr)
library(plyr)
library(lme4)
library(nlme)
library(gridExtra)
library(car)
Theme=theme_classic(base_size=11, base_family="Helvetica") +
theme(axis.line = element_line(linewidth = 1, colour = "black", linetype = "solid")) +theme(plot.title = element_text(size = 12))+ theme(panel.border=element_rect(fill=NA))
Theme2=Theme+ theme(legend.position="none") + theme(panel.border=element_rect(fill=NA))
ASVtable=read.table('input_data/from_phyloseq/ASVtable_marsh12024-10-08.txt', header=TRUE)
ASVtable=read.table('input_data/from_phyloseq/ASVtable_marsh12024-10-08.txt', header=TRUE)
ASVtable=read.table('input_data/ASVtable_marsh12024-10-08.txt', header=TRUE)
ASVtable=read.table('input_data/ASVtable_Marsh12021-07-20.txt', header=TRUE)
ASVtable=read.table('input_data/ASVtable_Marsh12021-07-20.txt', header=TRUE)
TAXtable=read.table('input_data/TAXtable_Marsh12021-07-20.txt', header=TRUE)
meta.table=read.table('input_data/METAtable_Marsh12021-07-20.txt', header=TRUE)
meta.table.edits=read.table('input_data/Metadata/METAtable_Marsh12021-07-20_edits2_withlocationandseason.txt', header=TRUE)
# remove mesocosm rows from metadata table
meta.table.edits2=meta.table.edits[-which(meta.table.edits$Location=='Mesocosm'),]
# remove mesocosm rows from metadata table
meta.table.edits2=meta.table #.edits[-which(meta.table.edits$Location=='Mesocosm'),]
# remove them from ASV table as well
ASVtable2=ASVtable[-which(meta.table.edits$Location=='Mesocosm'),]
# remove them from ASV table as well
ASVtable2=ASVtable[-which(meta.table$Location=='Mesocosm'),]
# season
meta.table.edits2$Season=factor(meta.table.edits2$Season,
levels=c('Autumn', 'Winter', 'Spring'))
# season
meta.table.edits2$Season=factor(meta.table$Season,
levels=c('Autumn', 'Winter', 'Spring'))
# season
meta.table$Season=factor(meta.table$Season,
levels=c('Autumn', 'Winter', 'Spring'))
meta.table$Season
meta.table.edits=read.table('input_data/Metadata/METAtable_Marsh12021-07-20_edits2_withlocationandseason.txt', header=TRUE)
meta.table.edits=read.table('input_data/METAtable_Marsh12021-07-20_edits2_withlocationandseason.txt', header=TRUE)
# remove mesocosm rows from metadata table
meta.table.edits2=meta.table.edits[-which(meta.table.edits$Location=='Mesocosm'),]
# remove them from ASV table as well
ASVtable2=ASVtable[-which(meta.table$Location=='Mesocosm'),]
# season
meta.table.edits2$Season=factor(meta.table.edits2$Season,
levels=c('Autumn', 'Winter', 'Spring'))
# location
meta.table.edits2$Location=factor(meta.table.edits2$Location,
levels=c('OxPond_1', 'OxPond2', 'Treatmentmarshes', 'EW_influent','Allen', 'Gearheart','Hauser', 'BayDischarge'))
# month: remove since it does not contribute much
#meta.table.edits2$Month=factor(meta.table.edits2$Month,
#                      levels=c('October', 'December', 'January'))
meta.table.edits2$Date_form=as.Date(meta.table.edits2$Date_form)
meta.table.edits2$dist_chlo=meta.table.edits2$Location
meta.table.edits2$dist_chlo=as.character(meta.table.edits2$dist_chlo)
meta.table.edits2[which(meta.table.edits2$dist_chlo=='Allen' |
meta.table.edits2$dist_chlo=='OxPond_1'),18]=1
meta.table.edits2[which(meta.table.edits2$dist_chlo=='Gearheart' |
meta.table.edits2$dist_chlo=='OxPond2'),18]=2
meta.table.edits2[which(meta.table.edits2$dist_chlo=='Hauser' |
meta.table.edits2$dist_chlo=='Treatmentmarshes'),18]=3
meta.table.edits2[which(meta.table.edits2$dist_chlo=='EW_influent'|
meta.table.edits2$dist_chlo=='BayDischarge'),18]=4
meta.table.edits2$dist_chlo=as.numeric(meta.table.edits2$dist_chlo)
richness=specnumber(ASVtable2)
shannon=diversity(ASVtable2, index='shannon')
meta.div=data.frame(meta.table.edits3, richness, shannon, simpson, evenness)
richness
# remove mesocosm rows from metadata table
meta.table.edits2=meta.table.edits[-which(meta.table.edits$Location=='Mesocosm'),]
# remove them from ASV table as well
ASVtable2=ASVtable[-which(meta.table$Location=='Mesocosm'),]
richness=specnumber(ASVtable2)
shannon=diversity(ASVtable2, index='shannon')
richness
ASVtable2)
ASVtable2
meta.table$Location
# remove mesocosm rows from metadata table
meta.table.edits2=meta.table.edits#[-which(meta.table.edits$Location=='Mesocosm'),]
# remove them from ASV table as well
ASVtable2=ASVtable#[-which(meta.table$Location=='Mesocosm'),]
# season
meta.table.edits2$Season=factor(meta.table.edits2$Season,
levels=c('Autumn', 'Winter', 'Spring'))
# location
meta.table.edits2$Location=factor(meta.table.edits2$Location,
levels=c('OxPond_1', 'OxPond2', 'Treatmentmarshes', 'EW_influent','Allen', 'Gearheart','Hauser', 'BayDischarge'))
# month: remove since it does not contribute much
#meta.table.edits2$Month=factor(meta.table.edits2$Month,
#                      levels=c('October', 'December', 'January'))
meta.table.edits2$Date_form=as.Date(meta.table.edits2$Date_form)
meta.table.edits2$dist_chlo=meta.table.edits2$Location
meta.table.edits2$dist_chlo=as.character(meta.table.edits2$dist_chlo)
meta.table.edits2[which(meta.table.edits2$dist_chlo=='Allen' |
meta.table.edits2$dist_chlo=='OxPond_1'),18]=1
meta.table.edits2[which(meta.table.edits2$dist_chlo=='Gearheart' |
meta.table.edits2$dist_chlo=='OxPond2'),18]=2
meta.table.edits2[which(meta.table.edits2$dist_chlo=='Hauser' |
meta.table.edits2$dist_chlo=='Treatmentmarshes'),18]=3
meta.table.edits2[which(meta.table.edits2$dist_chlo=='EW_influent'|
meta.table.edits2$dist_chlo=='BayDischarge'),18]=4
meta.table.edits2$dist_chlo=as.numeric(meta.table.edits2$dist_chlo)
meta.table.edits3=meta.table.edits2#[,-c(1,2,3,4,5,6,7,8,9,10,11,12,15)]
head(meta.table.edits3)
richness=specnumber(ASVtable2)
shannon=diversity(ASVtable2, index='shannon')
simpson=diversity(ASVtable2, index='simpson')
evenness=shannon/log(richness)
meta.div=data.frame(meta.table.edits3, richness, shannon, simpson, evenness)
setwd("~/Documents/GitHub/SGL/env_marsh_bef/scripts")
library(ggplot2)
library(vegan)
library(plyr)
library(dplyr)
Theme=theme_classic(base_size=11, base_family="Helvetica") +
theme(axis.line = element_line(linewidth = 1, colour = "black", linetype = "solid")) +theme(plot.title = element_text(size = 12))
## Without legends
Theme2=Theme+ theme(legend.position="none") + theme(panel.border=element_rect(fill=NA))
# load data
setwd('..') # set writing directory to script location and then go one folder up
## ASV table to calculate diversity metrics
ASVtable=read.table('phyloseq_outputs/ASVtable_Marsh12021-07-20.txt', header=TRUE)
ASVtable2=t(ASVtable)
ASVtable3=ASVtable2[-c(1:23),]
## Taxonomy table
TAXtable=read.table('phyloseq_outputs/TAXtable_Marsh12021-07-20.txt', header=TRUE)
## Metadata molecular from the phyloseq object
metatable=read.table('phyloseq_outputs/METAtable_Marsh12021-07-20.txt', header=TRUE)
metatable2=metatable[-c(1:23),]
metatable2$sampleID=metatable2$X.SampleID
## Metadata molecular (raw) - does not include sludge data
meta.table=read.csv('input_data/Metadata_marshstudy.csv', header=TRUE)
meta.table$sampleID=meta.table$SampleID
## Environmental data
env.table=read.csv('input_data/Envdata_marshstudy.csv', header=TRUE)
env.table2=env.table[-which(duplicated(env.table$sampleID)),]
# Edits and data processing
## summary environmental:
### removed sludge data
env.wSlu=env.table[-which(env.table$type=='sludge'),]
### saved version
env.summary.table=read.csv('input_data/TableDeltaNH3_Div.summary.211.csv', header=TRUE)
env.summary1=env.summary.table[,-1]
## Edits to metadata
### season
meta.env$Season=factor(meta.env$Season,
levels=c('Autumn', 'Winter', 'Spring'))
### location
meta.env$Location=factor(meta.env$Location,
levels=c('OxPond_1', 'OxPond2', 'Treatmentmarshes',
'EW_influent', 'Allen', 'Gearheart','Hauser',
'BayDischarge'))
## Edits to metadata
### season
meta.env$Season=factor(meta.env$Season,
levels=c('Autumn', 'Winter', 'Spring'))
# Edits and data processing
## summary environmental:
### removed sludge data
env.Slu=env.table[which(env.table$type=='sludge'),]
env.wSlu=env.table[-which(env.table$type=='sludge'),]
summary_table <- env_wSlu %>%
group_by(Location, Date) %>%
summarise(
Ammonia = mean(`Ammonia (mg/L)`, na.rm = TRUE),
BOD = mean(BOD, na.rm = TRUE),
Temperature = mean(`Water Temp. (C)`, na.rm = TRUE),
Percipitation = mean(`Percipitation (in)`, na.rm = TRUE)
)
### calculate average of replicate samples per pond/per date
summary_table <- env.wSlu %>%
group_by(Location, Date) %>%
summarise(
Ammonia = mean(`Ammonia (mg/L)`, na.rm = TRUE),
BOD = mean(BOD, na.rm = TRUE),
Temperature = mean(`Water Temp. (C)`, na.rm = TRUE),
Percipitation = mean(`Percipitation (in)`, na.rm = TRUE)
)
env.wSlu %>%
group_by(Location, Date)
